import{_ as ae}from"../chunks/preload-helper.a4192956.js";import{s as Q,f as w,g as b,h as C,d as m,k as re,j as _,i as A,v,z as F,B as Ae,A as te,C as be,l as J,a as P,m as H,c as I,u as W,D as T,n as K,E as ye,F as ie,G as ce,e as ue,o as $e,H as pe,I as fe,p as Fe}from"../chunks/scheduler.7e9ba9d1.js";import{S as X,i as Y,t as j,c as de,a as O,b as se,d as le,m as ne,e as oe,g as _e}from"../chunks/index.c7073289.js";import{d as Ee,w as De}from"../chunks/index.24199a4d.js";function me(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}const B=De({resources:[],spritemap:{}});Ee(B,n=>new Blob([JSON.stringify(n)],{type:"application/json"}));const Le=Ee(B,n=>{const e={src:["audio.mp3","audio.ogg"],sprite:n.resources.map(t=>({[t]:[n.spritemap[t].start,n.spritemap[t].end-n.spritemap[t].start]})).reduce((t,s)=>({...t,...s}),{})};return new Blob([JSON.stringify(e)],{type:"application/json"})});function Ne(n){let e,t;return{c(){e=w("div"),t=w("div"),this.h()},l(s){e=b(s,"DIV",{class:!0});var l=C(e);t=b(l,"DIV",{style:!0,class:!0}),C(t).forEach(m),l.forEach(m),this.h()},h(){re(t,"width",n[0]+"%"),_(t,"class","svelte-2iemiy"),_(e,"class","progress_bar svelte-2iemiy")},m(s,l){A(s,e,l),v(e,t)},p(s,[l]){l&1&&re(t,"width",s[0]+"%")},i:F,o:F,d(s){s&&m(e)}}}function Oe(n,e,t){let{progress:s=0}=e;return n.$$set=l=>{"progress"in l&&t(0,s=l.progress)},[s]}class Pe extends X{constructor(e){super(),Y(this,e,Oe,Ne,Q,{progress:0})}}function ge(n,e,t){const s=n.slice();return s[5]=e[t][0],s[6]=e[t][1],s}function he(n){let e,t,s=n[5]+"",l,a,o,i,u=Math.floor(n[6].start*1e4)/1e4+"",c,r,g,p,h=Math.floor(n[6].end*1e4)/1e4+"",k,L,z,S,y,q="Play",U,M,G;function Z(){return n[2](n[6])}function x(){return n[3](n[6])}return{c(){e=w("li"),t=w("span"),l=J(s),o=P(),i=w("span"),c=J(u),g=P(),p=w("span"),k=J(h),z=P(),S=w("span"),y=w("button"),y.textContent=q,U=P(),this.h()},l(d){e=b(d,"LI",{class:!0});var f=C(e);t=b(f,"SPAN",{title:!0,class:!0});var D=C(t);l=H(D,s),D.forEach(m),o=I(f),i=b(f,"SPAN",{title:!0,class:!0});var V=C(i);c=H(V,u),V.forEach(m),g=I(f),p=b(f,"SPAN",{title:!0,class:!0});var $=C(p);k=H($,h),$.forEach(m),z=I(f),S=b(f,"SPAN",{class:!0});var N=C(S);y=b(N,"BUTTON",{"data-svelte-h":!0}),W(y)!=="svelte-r26d3t"&&(y.textContent=q),N.forEach(m),U=I(f),f.forEach(m),this.h()},h(){_(t,"title",a=n[5]),_(t,"class","svelte-fz4vs6"),_(i,"title",r=n[6].start.toString()),_(i,"class","svelte-fz4vs6"),_(p,"title",L=n[6].end.toString()),_(p,"class","svelte-fz4vs6"),_(S,"class","svelte-fz4vs6"),_(e,"class","svelte-fz4vs6")},m(d,f){A(d,e,f),v(e,t),v(t,l),v(e,o),v(e,i),v(i,c),v(e,g),v(e,p),v(p,k),v(e,z),v(e,S),v(S,y),v(e,U),M||(G=[T(y,"click",Z),T(y,"keydown",x)],M=!0)},p(d,f){n=d,f&1&&s!==(s=n[5]+"")&&K(l,s),f&1&&a!==(a=n[5])&&_(t,"title",a),f&1&&u!==(u=Math.floor(n[6].start*1e4)/1e4+"")&&K(c,u),f&1&&r!==(r=n[6].start.toString())&&_(i,"title",r),f&1&&h!==(h=Math.floor(n[6].end*1e4)/1e4+"")&&K(k,h),f&1&&L!==(L=n[6].end.toString())&&_(p,"title",L)},d(d){d&&m(e),M=!1,ye(G)}}}function Ie(n){let e,t=me(Object.entries(n[0].spritemap)),s=[];for(let l=0;l<t.length;l+=1)s[l]=he(ge(n,t,l));return{c(){e=w("ul");for(let l=0;l<s.length;l+=1)s[l].c();this.h()},l(l){e=b(l,"UL",{class:!0});var a=C(e);for(let o=0;o<s.length;o+=1)s[o].l(a);a.forEach(m),this.h()},h(){_(e,"class","svelte-fz4vs6")},m(l,a){A(l,e,a);for(let o=0;o<s.length;o+=1)s[o]&&s[o].m(e,null)},p(l,[a]){if(a&3){t=me(Object.entries(l[0].spritemap));let o;for(o=0;o<t.length;o+=1){const i=ge(l,t,o);s[o]?s[o].p(i,a):(s[o]=he(i),s[o].c(),s[o].m(e,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=t.length}},i:F,o:F,d(l){l&&m(e),Ae(s,l)}}}function Te(n,e,t){let s;te(n,B,u=>t(0,s=u));const l=be();function a(u){l("playSegment",{sprite:u})}return[s,a,u=>a(u),u=>a(u)]}class je extends X{constructor(e){super(),Y(this,e,Te,Ie,Q,{})}}function ze(n){let e,t,s,l;return{c(){e=w("div"),t=w("input"),this.h()},l(a){e=b(a,"DIV",{class:!0,role:!0,tabindex:!0});var o=C(e);t=b(o,"INPUT",{type:!0,accept:!0,class:!0}),o.forEach(m),this.h()},h(){_(t,"type","file"),t.multiple=!0,_(t,"accept","audio/*"),_(t,"class","svelte-7eeame"),_(e,"class","dropzone svelte-7eeame"),_(e,"role","button"),_(e,"tabindex","0"),ie(e,"over",n[1])},m(a,o){A(a,e,o),v(e,t),s||(l=[T(t,"change",n[3]),T(t,"change",n[2]),T(e,"dragover",ce(n[4])),T(e,"dragleave",ce(n[5]))],s=!0)},p(a,[o]){o&2&&ie(e,"over",a[1])},i:F,o:F,d(a){a&&m(e),s=!1,ye(l)}}}function Ue(n,e,t){let s=null,l=!1;const a=be();function o(r){console.log(r),r.target.files,a("drop",s)}function i(){s=this.files,t(0,s)}return[s,l,o,i,r=>t(1,l=!0),r=>t(1,l=!1)]}class Re extends X{constructor(e){super(),Y(this,e,Ue,ze,Q,{})}}function Be(n){let e,t;return e=new Re({props:{$$slots:{default:[qe]},$$scope:{ctx:n}}}),e.$on("drop",n[11]),{c(){se(e.$$.fragment)},l(s){le(e.$$.fragment,s)},m(s,l){ne(e,s,l),t=!0},p(s,l){const a={};l&4194304&&(a.$$scope={dirty:l,ctx:s}),e.$set(a)},i(s){t||(O(e.$$.fragment,s),t=!0)},o(s){j(e.$$.fragment,s),t=!1},d(s){oe(e,s)}}}function Me(n){let e,t,s,l,a;return l=new Pe({props:{progress:n[4]}}),{c(){e=w("p"),t=J(n[5]),s=P(),se(l.$$.fragment)},l(o){e=b(o,"P",{});var i=C(e);t=H(i,n[5]),i.forEach(m),s=I(o),le(l.$$.fragment,o)},m(o,i){A(o,e,i),v(e,t),A(o,s,i),ne(l,o,i),a=!0},p(o,i){(!a||i&32)&&K(t,o[5]);const u={};i&16&&(u.progress=o[4]),l.$set(u)},i(o){a||(O(l.$$.fragment,o),a=!0)},o(o){j(l.$$.fragment,o),a=!1},d(o){o&&(m(e),m(s)),oe(l,o)}}}function Ve(n){let e,t="Loading ffmpeg...";return{c(){e=w("p"),e.textContent=t},l(s){e=b(s,"P",{"data-svelte-h":!0}),W(e)!=="svelte-v5qt5p"&&(e.textContent=t)},m(s,l){A(s,e,l)},p:F,i:F,o:F,d(s){s&&m(e)}}}function qe(n){let e,t="Drop audio files here";return{c(){e=w("p"),e.textContent=t},l(s){e=b(s,"P",{"data-svelte-h":!0}),W(e)!=="svelte-1yo73gu"&&(e.textContent=t)},m(s,l){A(s,e,l)},p:F,d(s){s&&m(e)}}}function ve(n){let e,t,s,l,a,o="Download",i,u,c,r,g;return u=new je({}),u.$on("playSegment",n[10]),{c(){e=w("div"),t=w("audio"),l=P(),a=w("button"),a.textContent=o,i=P(),se(u.$$.fragment),this.h()},l(p){e=b(p,"DIV",{class:!0});var h=C(e);t=b(h,"AUDIO",{src:!0,class:!0}),C(t).forEach(m),l=I(h),a=b(h,"BUTTON",{"data-svelte-h":!0}),W(a)!=="svelte-3kqluj"&&(a.textContent=o),h.forEach(m),i=I(p),le(u.$$.fragment,p),this.h()},h(){t.controls=!0,pe(t.src,s=n[2])||_(t,"src",s),_(t,"class","svelte-bdz1aw"),_(e,"class","audio_container svelte-bdz1aw")},m(p,h){A(p,e,h),v(e,t),n[12](t),v(e,l),v(e,a),A(p,i,h),ne(u,p,h),c=!0,r||(g=T(a,"click",n[9]),r=!0)},p(p,h){(!c||h&4&&!pe(t.src,s=p[2]))&&_(t,"src",s)},i(p){c||(O(u.$$.fragment,p),c=!0)},o(p){j(u.$$.fragment,p),c=!1},d(p){p&&(m(e),m(i)),n[12](null),oe(u,p),r=!1,g()}}}function Ge(n){let e,t,s,l,a;const o=[Ve,Me,Be],i=[];function u(r,g){return r[0]?r[5]!==r[7].idle?1:r[1]?-1:2:0}~(e=u(n))&&(t=i[e]=o[e](n));let c=n[6].resources.length>0&&ve(n);return{c(){t&&t.c(),s=P(),c&&c.c(),l=ue()},l(r){t&&t.l(r),s=I(r),c&&c.l(r),l=ue()},m(r,g){~e&&i[e].m(r,g),A(r,s,g),c&&c.m(r,g),A(r,l,g),a=!0},p(r,[g]){let p=e;e=u(r),e===p?~e&&i[e].p(r,g):(t&&(_e(),j(i[p],1,1,()=>{i[p]=null}),de()),~e?(t=i[e],t?t.p(r,g):(t=i[e]=o[e](r),t.c()),O(t,1),t.m(s.parentNode,s)):t=null),r[6].resources.length>0?c?(c.p(r,g),g&64&&O(c,1)):(c=ve(r),c.c(),O(c,1),c.m(l.parentNode,l)):c&&(_e(),j(c,1,1,()=>{c=null}),de())},i(r){a||(O(t),O(c),a=!0)},o(r){j(t),j(c),a=!1},d(r){r&&(m(s),m(l)),~e&&i[e].d(r),c&&c.d(r)}}}const we="https://unpkg.com/@ffmpeg/core@0.12.3/dist/esm";function Je(n,e,t){let s,l;te(n,Le,d=>t(20,s=d)),te(n,B,d=>t(6,l=d));let a=null,o=!1,i=null,u=!1,c=null,r=null,g=null,p=null,h=0,k=null,L=null,z=0,S="IDLE",y={idle:"IDLE",loading:"LOADING",processing:"PROCESSING",concatenating:"CONCATENATING",complete:"COMPLETE"};$e(async()=>{console.log("loading ffmpeg"),o||await q(),t(0,o=!0),console.log("loaded ffmpeg")});const q=async()=>{const{FFmpeg:d}=await ae(()=>import("../chunks/index.23e2fae8.js"),[],import.meta.url),{toBlobURL:f}=await ae(()=>import("../chunks/index.c5152193.js"),[],import.meta.url);a=new d,a.on("log",({message:D})=>{console.log(D)}),await a.load({coreURL:await f(`${we}/ffmpeg-core.js`,"text/javascript"),wasmURL:await f(`${we}/ffmpeg-core.wasm`,"applicaiton/wasm")})},U=async d=>{console.log(d),t(5,S=y.processing);const f=[],D=new FileReader;let V=null,$=null,N=[],ee=0;const ke=async()=>{ee+=1,t(4,z=ee/d.length*100),ee===d.length&&(await Se(),t(5,S=y.complete),setTimeout(()=>{t(5,S=y.idle)},1e3))},Se=async()=>{t(5,S=y.concatenating),await a.writeFile("concat_list.txt",f.join(`
`)),await a.exec(["-f","concat","-safe","0","-i","concat_list.txt","outputAll.mp3"]),await a.exec(["-i","outputAll.mp3","outputAll.ogg"]),l.resources.forEach((E,R)=>{fe(B,l.spritemap[E]={start:h,end:h+N[R]},l),h+=N[R]}),i=await a.readFile("outputAll.mp3"),c=new File([i.buffer],"audio.mp3",{type:"audio/mpeg"}),r=new File([i.buffer],"audio.ogg",{type:"audio/ogg"}),t(2,g=URL.createObjectURL(c)),t(1,u=!0)};for(let E=0;E<d.length;E+=1)$=d[E],l.resources.push($.name),fe(B,l.spritemap[$.name]={start:0,end:0},l),V=new Uint8Array(await $.arrayBuffer()),await a.writeFile($.name,V),f.push(`file 'item${E}.mp3'`),D.onloadend=R=>{console.log(typeof R.target.result,R.target.result),new AudioContext().decodeAudioData(R.target.result,async Ce=>{N[E]=Ce.duration,console.log(E,N[E],$.name),await a.exec(["-i",l.resources[E],"-af",`afade=in:st=0:d=0.01,afade=out:st=${N[E]-.01}:d=0.01`,`item${E}.mp3`]),await a.deleteFile(l.resources[E]),ke()})},await D.readAsArrayBuffer($)},M=async()=>{p=new File([s],"sprite.json",{type:"application/json"}),[c,r,p].forEach(d=>{const f=document.createElement("a");f.href=URL.createObjectURL(d),f.download=d.name,f.click(),f.remove()})},G=d=>{const{start:f,end:D}=d.detail.sprite;t(3,k.currentTime=f,k),k.play(),L&&clearTimeout(L),L=setTimeout(()=>{k.pause()},(D-f)*1e3)},Z=d=>U(d.detail);function x(d){Fe[d?"unshift":"push"](()=>{k=d,t(3,k)})}return[o,u,g,k,z,S,l,y,U,M,G,Z,x]}class Ye extends X{constructor(e){super(),Y(this,e,Je,Ge,Q,{})}}export{Ye as component};
